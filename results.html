<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analysis Results - Customer Churn Predictor</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        padding: 40px;
      }

      h1 {
        color: #667eea;
        margin-bottom: 30px;
        text-align: center;
      }

      .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
      }

      .metric-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 25px;
        border-radius: 15px;
        text-align: center;
      }

      .metric-value {
        font-size: 2.5em;
        font-weight: bold;
        margin: 10px 0;
      }

      .metric-label {
        font-size: 0.9em;
        opacity: 0.9;
      }

      .section {
        margin-bottom: 40px;
      }

      .section-title {
        color: #667eea;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #667eea;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      th {
        background: #667eea;
        color: white;
        padding: 15px;
        text-align: left;
      }

      td {
        padding: 12px 15px;
        border-bottom: 1px solid #ddd;
      }

      tr:hover {
        background: #f8f9ff;
      }

      .risk-high {
        background: #ff4444;
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
        font-weight: bold;
      }

      .risk-medium {
        background: #ffaa00;
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
        font-weight: bold;
      }

      .risk-low {
        background: #00cc66;
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
        font-weight: bold;
      }

      .download-buttons {
        display: flex;
        gap: 15px;
        margin: 30px 0;
        flex-wrap: wrap;
      }

      .download-btn {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
        padding: 12px 30px;
        border: none;
        border-radius: 50px;
        text-decoration: none;
        cursor: pointer;
        transition: transform 0.2s;
      }

      .download-btn:hover {
        transform: scale(1.05);
      }

      .back-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 12px 30px;
        border: none;
        border-radius: 50px;
        text-decoration: none;
        display: inline-block;
        margin-bottom: 30px;
        transition: transform 0.2s;
      }

      .back-btn:hover {
        transform: scale(1.05);
      }

      .error-message {
        background: #f8d7da;
        color: #721c24;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <a href="/" class="back-btn">‚Üê Back to Upload</a>

      <h1>üìä Analysis Results</h1>

      {% if error %}
      <div class="error-message">
        <h3>{{ error }}</h3>
        <p>Please upload a dataset and run the analysis first.</p>
      </div>
      {% else %}
      <div class="metrics-grid">
        <div class="metric-card">
          <div class="metric-label">Total Customers</div>
          <div class="metric-value">{{ summary.total_customers }}</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">High Risk</div>
          <div class="metric-value">{{ summary.high_risk }}</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Medium Risk</div>
          <div class="metric-value">{{ summary.medium_risk }}</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Low Risk</div>
          <div class="metric-value">{{ summary.low_risk }}</div>
        </div>
      </div>

      <div class="section">
        <h2 class="section-title">üí∞ ROI Analysis</h2>
        <div class="metrics-grid">
          <div
            class="metric-card"
            style="
              background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            "
          >
            <div class="metric-label">Total Cost</div>
            <div class="metric-value">
              ${{ "{:,.0f}".format(summary.total_cost) }}
            </div>
          </div>
          <div
            class="metric-card"
            style="
              background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            "
          >
            <div class="metric-label">Expected Revenue</div>
            <div class="metric-value">
              ${{ "{:,.0f}".format(summary.expected_revenue) }}
            </div>
          </div>
          <div
            class="metric-card"
            style="
              background: linear-gradient(135deg, #ffa726 0%, #fb8c00 100%);
            "
          >
            <div class="metric-label">Net Benefit</div>
            <div class="metric-value">
              ${{ "{:,.0f}".format(summary.expected_revenue -
              summary.total_cost) }}
            </div>
          </div>
        </div>
      </div>

      <div class="download-buttons">
        <a href="/download/predictions" class="download-btn"
          >üì• Download Predictions</a
        >
        <a href="/download/strategies" class="download-btn"
          >üì• Download Strategies</a
        >
        <a href="/download/roi" class="download-btn"
          >üì• Download ROI Analysis</a
        >
      </div>

      <div class="section">
        <h2 class="section-title">üö® High-Risk Customers (Top 10)</h2>
        <p style="color: #666; margin-bottom: 15px">
          These customers require immediate attention
        </p>

        <table>
          <thead>
            <tr>
              <th>Customer ID</th>
              <th>Churn Probability</th>
              <th>Risk Level</th>
            </tr>
          </thead>
          <tbody>
            {% for customer in high_risk_customers %}
            <tr>
              <td>{{ customer.CustomerID }}</td>
              <td>{{ "{:.1%}".format(customer.ChurnProbability) }}</td>
              <td>
                <span class="risk-{{ customer.RiskLevel|lower }}"
                  >{{ customer.RiskLevel }}</span
                >
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="section">
        <h2 class="section-title">üìä ROI Breakdown by Risk Level</h2>
        <table>
          <thead>
            <tr>
              <th>Risk Level</th>
              <th>Customers</th>
              <th>Total Cost</th>
              <th>Expected Revenue</th>
              <th>ROI</th>
            </tr>
          </thead>
          <tbody>
            {% for row in roi_data %}
            <tr>
              <td>
                <span class="risk-{{ row.RiskLevel|lower }}"
                  >{{ row.RiskLevel }}</span
                >
              </td>
              <td>{{ row.Customers }}</td>
              <td>${{ "{:,.0f}".format(row.TotalCost) }}</td>
              <td>${{ "{:,.0f}".format(row.ExpectedRevenue) }}</td>
              <td>{{ row.ROI }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% endif %}
    </div>
  </body>
</html>
